# V0 演示清单

> 对应《开发收敛与可交付路线图》V0 验收：**环境准备 → 上传简历 → 调用匹配 API → 看到匹配结果**；新成员按本文档可跑通端到端链路。

---

## 独立交付测试说明

**仅凭 GitHub 上的 Tatha 仓库即可独立交付测试**，无需克隆 JobFirst、poetry-knowledge-base 等其它仓库。

| 项目 | 说明 |
|------|------|
| **运行依赖** | 仅本仓代码 + `requirements.txt` / `pyproject.tol` + Python 3.10+；无对其它仓库的代码依赖。 |
| **配置** | 复制 `.env.example` 为 `.env`，填写至少一个 LLM Key（OpenAI / DeepSeek / Anthropic 等），即可跑通意图解析、简历解析、职位匹配、诗词推荐、征信解析、MBTI 等。 |
| **V0 核心验收** | 按 §一～§三：启动 API → 用 curl 或脚本调用「上传/解析 + 匹配」→ 看到匹配结果；可选运行 `./scripts/test_improvements.sh` 做全量检查。 |
| **可选能力** | RAG（§7 §8）需先构建索引；诗词 RAG 可选依赖 poetry-knowledge-base 数据源。不做 RAG 时，单入口、解析、匹配、推荐一句诗（LLM）、MBTI 等均可用。 |
| **13 项测试** | 仅配置 1 个 LLM Key 时，`./scripts/test_improvements.sh` 可**跑完**全部 13 项且脚本不报错退出。其中 §7、§8（RAG 查询）**没有结果断言**，未建索引时也会执行通过，但 RAG 返回的 `answer` 可能为空或错误；其余 §1～§6、§9～§13 均有断言，需 API 与 Key 正常才能通过。若希望 §7 §8 也返回有效 RAG 答案，需先按 README 构建 resume / poetry 索引。 |
| **文档链接** | README 中指向「JobFirst 路线图」等为 `../JobFirst/docs/...`，仅在 monorepo 或本地同时克隆 JobFirst 时有效；**仅克隆 Tatha 时该链接不可用，不影响 API 运行与交付测试**。 |

---

## 一、环境准备

1. **Python**：3.10+，建议使用虚拟环境或 [ServBay](https://www.servbay.com)。
2. **依赖**：在 Tatha 根目录执行  
   `pip install -r requirements.txt` 或 `uv sync`。
3. **配置**：复制 `.env.example` 为 `.env`，至少配置一项模型 Key（任选其一）：
   - `OPENAI_API_KEY`
   - `DEEPSEEK_API_KEY`
   - `ANTHROPIC_API_KEY`  
   职位匹配与意图解析会使用 `TATHA_DEFAULT_MODEL`（如 `deepseek/deepseek-chat`）。可选：`TATHA_API_PORT=8010`（默认 8010）。
4. **启动 API**：
   ```bash
   uv run uvicorn tatha.api.app:app --host 127.0.0.1 --port 8010
   ```
5. **验证探活**：
   ```bash
   curl -s http://127.0.0.1:8010/health
   ```
   应返回 `{"status":"ok","service":"tatha"}`。

6. **V0 收尾验收（不启动 API 也可跑）**：在进程内用 TestClient 验证「健康检查 → 订阅页 → demo 页 → 匹配 API」是否跑通：
   ```bash
   uv run python scripts/verify_v0_demo.py
   ```
   通过则终端输出「V0 匹配体验验收通过」，并写入 `verify_v0_result.txt`。匹配接口需配置 `.env` 中至少一个 LLM Key 才会有真实打分；未配置时接口仍返回 200，匹配列表可能为空或带「打分失败」提示。

---

## 二、上传简历（文档转换）

将一份简历文本或文件转为 Markdown，并可选做结构化提取：

```bash
# 方式 A：直接上传文件（PDF/Word/Excel 会先转 Markdown）
curl -s -X POST http://127.0.0.1:8010/v1/documents/convert \
  -F "file=@你的简历.pdf" -F "document_type=resume"

# 方式 B：用单入口携带简历文本做解析（见下节匹配时一并传入）
# 本节可跳过，匹配时在 body 里传 resume_text 即可
```

若只做「匹配」演示，可不实际上传文件，下一步直接传简历文本即可。

---

## 三、调用匹配 API，看到匹配结果

**单入口方式**（推荐，与中央大脑一致）：

```bash
curl -s -X POST http://127.0.0.1:8010/v1/ask \
  -H "Content-Type: application/json" \
  -d '{
    "message": "帮我匹配一下岗位",
    "resume_text": "张三，本科北京大学计算机系，擅长 Python、FastAPI、数据分析，有 3 年互联网产品经验。"
  }'
```

或**直接调用职位匹配接口**：

```bash
curl -s -X POST http://127.0.0.1:8010/v1/jobs/match \
  -H "Content-Type: application/json" \
  -d '{
    "resume_text": "张三，本科北京大学计算机系，擅长 Python、FastAPI、数据分析，有 3 年互联网产品经验。",
    "top_n": 5
  }'
```

**预期**：返回 JSON，其中 `matches` 为非空数组，每条含 `job`（title、company、location、description）和 `score`（overall、skills_overlap 等）；按 `score.overall` 降序。

---

## 四、Web 端登录注册测试

认证订阅页与匹配体验页已具备；登录/注册为**演示桩**（未对接 Zervigo/真实认证），用于验收「Web 端可完成注册/登录并跳转」。

1. **启动 API**（若未启动）：
   ```bash
   uv run uvicorn tatha.api.app:app --host 127.0.0.1 --port 8010
   ```
2. **打开认证订阅页**：浏览器访问 **http://127.0.0.1:8010/** 。
3. **进入登录/注册页**：点击「注册」或「登录」，或访问 **http://127.0.0.1:8010/auth.html** 。
4. **注册测试**：在「注册」标签下填写邮箱、密码、确认密码，点击「注册」。预期：接口返回成功，页面上显示「注册成功（演示用…）」并约 0.8 秒后跳转到 **demo.html** 。
5. **登录测试**：在「登录」标签下填写邮箱、密码，点击「登录」。预期：接口返回成功，页面上显示「登录成功（演示用…）」并跳转到 **demo.html** 。
6. **接口说明**：`POST /v1/auth/login` 与 `POST /v1/auth/register` 为演示桩，仅校验格式并返回 `ok: true` 与占位 token，不写库、不对接真实认证。V1 再对接 Zervigo 或多方式登录。

**一键验收（含登录注册接口）**：运行 `uv run python scripts/verify_v0_demo.py` 会顺带请求 `GET /auth.html` 与 `POST /v1/auth/login`，通过即表示登录注册接口可拉通。

---

## 五、一键验收脚本（可选）

主仓提供改进成果测试脚本，覆盖健康检查、订阅页、demo 页、匹配/ask 接口、**登录注册页与 auth 桩接口**等。运行前**不需**启动 API（脚本内用 TestClient 调用 app）：

```bash
uv run python scripts/verify_v0_demo.py
```

通过则输出「V0 验收通过（含匹配体验与登录注册桩）」；并写入 `verify_v0_result.txt`。

另有一份**需先启动 API** 的改进成果测试脚本，覆盖单入口意图、简历解析、诗词/征信/MBTI、E2E 三阶段等（运行前需 API 已启动）：

```bash
./scripts/test_improvements.sh
```

其中 §2（无简历时 pending）、§3（简历解析）、§12（E2E Resume → Job → Company）与 V0 核心链路一致；§12 会执行「简历 → 职位匹配 → 取首条公司 → 征信解析」三阶段并做断言。

**不依赖已启动 API 的本地 E2E**：

```bash
uv run python scripts/test_resume_job_company_flow.py [简历文件路径]
```

默认使用内置简历摘要，依次执行三阶段并断言。

---

## 六、V0 验收对照

| 路线图要求 | Tatha 对应 |
|------------|------------|
| 单一入口 | `POST /v1/ask`，中央大脑解析意图后分发 |
| 简历解析 + 向量化 + 职位匹配 API | 解析：`POST /v1/documents/convert` 或 /v1/ask 带正文；向量化：LlamaIndex/FAISS，可选 build_index；匹配：/v1/ask（intent=job_match）或 `POST /v1/jobs/match` |
| 环境准备 → 上传简历 → 调用匹配 API → 看到匹配结果 | 本文档 §一～§三 |
| 新成员按文档能跑通 | 按 §一 准备环境并启动 API，按 §三 发请求即可看到匹配结果 |

---

**文档版本**：与 Tatha 主仓 V0 能力一致；若路线图或主仓能力变更，请同步更新本文档。

---

## 七、V0 之后的工作安排与开发计划

V0 阶段之后的版本定义、排期与实现路径**不在本仓**，而在 JobFirst 的收敛文档中：

| 文档 | 路径 | 内容 |
|------|------|------|
| **开发收敛与可交付路线图** | [JobFirst/docs/开发收敛与可交付路线图.md](../JobFirst/docs/开发收敛与可交付路线图.md) | **§三** V1（Web 闭环 / 认证）、V2（多端/触达）、V3（生态嵌入）；**§四** 执行纪律与需求对号入座；**§六** 个人 AI 助理版（ZeroClaw）路线；**§七** 实现路径（助理主线 V1 多通道+Zervigo、V2 提醒/生态） |
| **JobFirst 个人 AI 助理版（ZeroClaw 路线）** | [JobFirst/docs/JobFirst个人AI助理版_ZeroClaw路线.md](../JobFirst/docs/JobFirst个人AI助理版_ZeroClaw路线.md) | 助理形态、Tool 设计、V1/V2 在助理侧的交付定义、过往项目宝藏（征信/MBTI/诗人等） |

Tatha 主仓当前对应「主仓 API + 中央大脑」，后续按路线图接入 Zervigo、多通道或 Web 时，仍以该路线图为版本与排期依据。
