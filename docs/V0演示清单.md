# V0 演示清单

> 对应《开发收敛与可交付路线图》V0 验收：**环境准备 → 上传简历 → 调用匹配 API → 看到匹配结果**；新成员按本文档可跑通端到端链路。

---

## 一、环境准备

1. **Python**：3.10+，建议使用虚拟环境或 [ServBay](https://www.servbay.com)。
2. **依赖**：在 Tatha 根目录执行  
   `pip install -r requirements.txt` 或 `uv sync`。
3. **配置**：复制 `.env.example` 为 `.env`，至少配置一项模型 Key（任选其一）：
   - `OPENAI_API_KEY`
   - `DEEPSEEK_API_KEY`
   - `ANTHROPIC_API_KEY`  
   职位匹配与意图解析会使用 `TATHA_DEFAULT_MODEL`（如 `deepseek/deepseek-chat`）。可选：`TATHA_API_PORT=8010`（默认 8010）。
4. **启动 API**：
   ```bash
   uv run uvicorn tatha.api.app:app --host 127.0.0.1 --port 8010
   ```
5. **验证探活**：
   ```bash
   curl -s http://127.0.0.1:8010/health
   ```
   应返回 `{"status":"ok","service":"tatha"}`。

---

## 二、上传简历（文档转换）

将一份简历文本或文件转为 Markdown，并可选做结构化提取：

```bash
# 方式 A：直接上传文件（PDF/Word/Excel 会先转 Markdown）
curl -s -X POST http://127.0.0.1:8010/v1/documents/convert \
  -F "file=@你的简历.pdf" -F "document_type=resume"

# 方式 B：用单入口携带简历文本做解析（见下节匹配时一并传入）
# 本节可跳过，匹配时在 body 里传 resume_text 即可
```

若只做「匹配」演示，可不实际上传文件，下一步直接传简历文本即可。

---

## 三、调用匹配 API，看到匹配结果

**单入口方式**（推荐，与中央大脑一致）：

```bash
curl -s -X POST http://127.0.0.1:8010/v1/ask \
  -H "Content-Type: application/json" \
  -d '{
    "message": "帮我匹配一下岗位",
    "resume_text": "张三，本科北京大学计算机系，擅长 Python、FastAPI、数据分析，有 3 年互联网产品经验。"
  }'
```

或**直接调用职位匹配接口**：

```bash
curl -s -X POST http://127.0.0.1:8010/v1/jobs/match \
  -H "Content-Type: application/json" \
  -d '{
    "resume_text": "张三，本科北京大学计算机系，擅长 Python、FastAPI、数据分析，有 3 年互联网产品经验。",
    "top_n": 5
  }'
```

**预期**：返回 JSON，其中 `matches` 为非空数组，每条含 `job`（title、company、location、description）和 `score`（overall、skills_overlap 等）；按 `score.overall` 降序。

---

## 四、一键验收脚本（可选）

主仓提供改进成果测试脚本，覆盖健康检查、单入口意图、简历解析、职位匹配、诗词/征信/MBTI、E2E 三阶段等。运行前需 API 已启动：

```bash
./scripts/test_improvements.sh
```

其中 §2（无简历时 pending）、§3（简历解析）、§12（E2E Resume → Job → Company）与 V0 核心链路一致；§12 会执行「简历 → 职位匹配 → 取首条公司 → 征信解析」三阶段并做断言。

**不依赖已启动 API 的本地 E2E**：

```bash
uv run python scripts/test_resume_job_company_flow.py [简历文件路径]
```

默认使用内置简历摘要，依次执行三阶段并断言。

---

## 五、V0 验收对照

| 路线图要求 | Tatha 对应 |
|------------|------------|
| 单一入口 | `POST /v1/ask`，中央大脑解析意图后分发 |
| 简历解析 + 向量化 + 职位匹配 API | 解析：`POST /v1/documents/convert` 或 /v1/ask 带正文；向量化：LlamaIndex/FAISS，可选 build_index；匹配：/v1/ask（intent=job_match）或 `POST /v1/jobs/match` |
| 环境准备 → 上传简历 → 调用匹配 API → 看到匹配结果 | 本文档 §一～§三 |
| 新成员按文档能跑通 | 按 §一 准备环境并启动 API，按 §三 发请求即可看到匹配结果 |

---

**文档版本**：与 Tatha 主仓 V0 能力一致；若路线图或主仓能力变更，请同步更新本文档。
